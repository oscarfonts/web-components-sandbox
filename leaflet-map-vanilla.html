<template>
	<style>
		@import "//cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.css";
		:host #map {
			display: block;
			height: 100%;
		}
	</style>
	<div id="map"></div>
</template>
<script src="//cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.js"></script>
<script>
	// Using Custom Elements v0 spec: https://www.html5rocks.com/en/tutorials/webcomponents/customelements/
	(function() {
		var localDocument = (document._currentScript || document.currentScript).ownerDocument;
		var customElement = Object.create(HTMLElement.prototype);

		customElement.createdCallback = function() {
			var template = localDocument.querySelector('template');
			this.shadowDOM = this.createShadowRoot();
			this.shadowDOM.appendChild(document.importNode(template.content, true));
		};

		customElement.attachedCallback = function() {
			setTimeout(this.ready.bind(this), 0);
		};

		customElement.ready = function() {
			var mapElement = this.shadowDOM.querySelector("#map");

			this.map = L.map(mapElement, {
				center: [41.4, 2.1],
				zoom: 12
			});

			L.tileLayer("http://vertex.fonts.cat:8081/styles/bright-v9/rendered/{z}/{x}/{y}.png").addTo(this.map);
		}

		document.registerElement('leaflet-map', {
			prototype: customElement
		});
	}());
</script>
